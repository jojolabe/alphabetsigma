<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Alphabet Sigma</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="João Pedro Oliveira" /><meta name="description" content="Um blog sobre números, letras e suas interseções." />






<meta name="generator" content="Hugo 0.69.2 with theme even" />


<link rel="canonical" href="/" />
  <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Alphabet Sigma" />
  <link href="/index.xml" rel="feed" type="application/rss+xml" title="Alphabet Sigma" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.78f8f17bab244b9ee62ad16480c9584d5fc2db06ae20681d1ca225cefd80767c.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Alphabet Sigma" />
<meta property="og:description" content="Um blog sobre números, letras e suas interseções." />
<meta property="og:type" content="website" />
<meta property="og:url" content="/" />
<meta property="og:updated_time" content="2016-05-05T21:48:51-07:00" />
<meta itemprop="name" content="Alphabet Sigma">
<meta itemprop="description" content="Um blog sobre números, letras e suas interseções."><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Alphabet Sigma"/>
<meta name="twitter:description" content="Um blog sobre números, letras e suas interseções."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Alphabet Sigma</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Alphabet Sigma</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <section id="posts" class="posts">
    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/text-data-from-image-tesseract/">Extraindo uma identidade: o pacote Tesseract e a transformação de imagem em texto.</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-05-12 </span>
      <div class="post-category">
          <a href="/categories/dificuldade-intermedi%C3%A1ria/"> dificuldade intermediária </a>
          </div>
    </div>
  </header>
  
  <div class="post-content">
    <div class="post-summary">
      

<div id="TOC">
no
</div>

<div class="figure">
<img src="../../img/id_digital.jpg" alt="banner_id_digital" />
<p class="caption">banner_id_digital</p>
</div>
<p>Lidar com imagens em R é algo que tem um quê de dificuldade, até por conta da escassez de material que se propõe a lhe ensinar como fazer o tratamento. Já vinha alimentando essa curiosidade minha há tempos, queria entender como fazer a extração de dados que originalmente estão encravados em uma imagem.</p>
<p>Quando surgiu uma polêmica no Twitter - devido à uma horda de adolescentes terem tido a genial ideia de postar foto de seus documentos online -, foi me dado o incentivo para gastar o tempo - em que eu deveria estar trabalhando - em mais um post para este lindo blog.</p>
<p>Primeiro vale falar que não é uma tarefa simples, faltam ferramentas para executarem determinadas tarefas, em especial na fase de pré-processamento de imagem. Também ressalto que esse não tem como objetivo ser um tutorial definitivo sobre tratamento de imagem em R, é só uma brincadeira que pode lhe introduzir ao assunto. Por fim, <strong>pontuo que alguns trechos de código aqui presentes (com especial atenção às expressões regulares) estão intencionalmente confusos</strong>, decidi por fazer isso justamente para dificultar o uso do código aqui presente para fins escusos.</p>
<hr />
<p>Começo então carregando as bibliotecas necessárias:</p>
<pre class="r"><code>library(&#39;tesseract&#39;) # Transforma imagens em texto.
library(&#39;magick&#39;) # Tratamento de imagens
library(&#39;stringr&#39;) # Tratamento de texto
library(&#39;tidyverse&#39;) # Metabiblioteca
library(&#39;image.libfacedetection&#39;) # Detecta faces
library(&#39;stringi&#39;) # Tratamento de textos
library(&#39;purrr&#39;) # Programação Funcional</code></pre>
<p>Agora eu começarei efetivamente a extrair o texto das imagens, primeiro eu irei observar a imagem que há de ser analisada:</p>
<div class="figure">
<img src="../../img/id_verso.png" alt="verso" />
<p class="caption">verso</p>
</div>
<p>Temos aqui o verso de um documento de identidade comum, dependendo de quão no futuro você esteja, talvez não conheça esse padrão do documento. Esse é o padrão de identidade antigo, e neste ano de 2020, a maior parte das identidades estão nesse padrão.</p>
<p><em>Vale notar que essa identidade é fictícia, e os numeros são todos falsos. A ‘Maria Eduarda’ não existe.</em></p>
<pre class="r"><code>remove_acct_char &lt;- function(str){
  #&#39; Essa função remove os acentos das palavras.
      
    stringi::stri_trans_general(str, id= &quot;Latin-ASCII&quot;)
}


  id &lt;- tesseract::ocr(&#39;../../img/id_verso.png&#39;, 
                     engine = tesseract(&#39;por&#39;)) %&gt;% 
  str_replace_all(pattern = &#39;\n&#39;, 
                  replacement = &#39; &#39;) %&gt;% {
  list(
  rg = stringr::str_extract(., pattern = &#39;\\d{2}\\..{3}\\..{3}\\-\\d&#39;), #extrai o RG
  
  nome = stringr::str_extract_all(., pattern = &#39;((Nove|Nome)(\\s\\w{1,20}\\s\\w{1,20}\\s(\\w{1,20})?\\s(\\w{1,})?))&#39;), #extrai
  
  datas = stringr::str_extract_all(., pattern = &#39;\\d{2}/(\\w{3}|\\d{2})/(\\d{4})&#39;), #extrai data de nascimento e expedição
  
  cpf = stringr::str_extract(., pattern = &#39;(\\d{3}\\.){2}\\d{3}\\-.{2}&#39;), #extrai o CPF
  
  doc_origem = remove_acct_char(stringr::str_extract(., pattern = &#39;(C(\\.\\s)NASC).{1,50}\\w{2}&#39;)) #Dados da certidão de nascimento.
  )
  } %&gt;% 
    unlist %&gt;% 
    enframe</code></pre>
<p>Começo criando uma função que futuramente será útil, a função <code>remove_acct_char</code>. Essa função que criamos usa da mudança de <code>encoding</code>, por meio da função <code>stringi::stri_trans_general()</code>, para fazer a remoção de acentuação das palavras. Um exemplo pode ser visto abaixo: casarão =&gt; casarao.</p>
<pre class="r"><code>remove_acct_char(&#39;Eu vivo em um casarão&#39;)</code></pre>
<pre><code>## [1] &quot;Eu vivo em um casarao&quot;</code></pre>
<ul>
<li>Logo depois eu crio um objeto chamado id, é nele em que armazenarei o resultado da extração das informações da identidade da nossa querida Maria Eduarda.</li>
</ul>
<p>Começarei usando a biblioteca <code>tesseract</code>, que faz a leitura de imagem e extrai o texto ali presente. Para que a Tesseract funcione é recomendado que os dados estejam alinhados, isto é, o texto precisa estar em linhas, texto na diagonal (ou de cabeça para baixo) pode gerar problemas, provavelmente irá. Uso o argumento <code>engine='por'</code>, que indica ao Tesseract que a linguagem do documento é português, assim o processamento é otimizado para nosso idioma. O Tesseract irá retornar o texto abaixo:</p>
<pre><code>## [1] &quot;E S = =\nBERTRO. 52.2x4.654-1 PNSBE.o 04/DEZ/2021\nNove MARIA EDUARDA DA SILVA\n\nEDUARDO RIBEIRO DA SILVA\n\nANA CLAUDIA DA SILVA\n\nVITÓRIA - ES 01/DEZ/1989\n6c omcem C. NASC \&quot;LIV 84X — FLS 19X / TERM 14188X co07\n\nVITÓRIA Es\ncm 314.291.255-XX\nASSINATUBA DO DIRETOR 020X\n\n= c E =E = =\n&quot;</code></pre>
<p>Logo após isso, eu irei passar a string por uma expressão regular com o objetivo de substituir o padrão ‘’ por um espaço em branco. O padrão indica ao programador que ali temos uma quebra de linha, mas não será util a nós, por isso a remoção.</p>
<p>Então, crio uma <code>list</code> que agrupará das strings com o texto que faremos a extração por meio de expressões regulares. Uso expressões regulares para extrair os seguintes dados: <code>rg</code>, <code>cpf</code>, <code>datas</code> (expedição e nascimento), <code>doc_origem</code> - este último são os dados acerca da Certidão de Nascimento.</p>
<p>Por fim, retiro as informações da <code>list</code>, usando <code>unlist()</code>, issso farácom que nossa lista se torne um conjunto de strings. E então uso a função <code>enframe</code> para criar uma <code>data.frame</code>- na verdade, uma <code>tibble</code> - com nossos dados.</p>
<pre><code>## # A tibble: 6 x 2
##   name       value                                                       
##   &lt;chr&gt;      &lt;chr&gt;                                                       
## 1 rg         &quot;52.2x4.654-1&quot;                                              
## 2 nome       &quot;Nove MARIA EDUARDA DA SILVA&quot;                               
## 3 datas1     &quot;04/DEZ/2021&quot;                                               
## 4 datas2     &quot;01/DEZ/1989&quot;                                               
## 5 cpf        &quot;314.291.255-XX&quot;                                            
## 6 doc_origem &quot;C. NASC \&quot;LIV 84X - FLS 19X / TERM 14188X co07  VITORIA Es&quot;</code></pre>
<p>O resultado contudo não é satisfatório, como pode-se ver a nossa tabela não está em formato Tidy, o que dificulda nosso trabalho. Devemos agora tratar a tabela, tornando-a ideal para a manipulação usando o <code>dplyr</code> e o <code>tidyr</code>. Além disso, a nossa expressão regular também capturou um trecho ‘Nove’ que está anterior ao nome de Maria Eduarda, precisamos corrigir isso.</p>
<pre class="r"><code>id %&gt;% 
  pivot_wider() %&gt;%  # &#39;gira&#39; a tabela, transformando-a em formato longo
  mutate(nome = str_remove(nome, &#39;(Nove|Nome)\\s&#39;), #r
         rg = toupper(rg)) %&gt;% 
  rename(exp = datas1,
         nasc = datas2)</code></pre>
<pre><code>## # A tibble: 1 x 6
##   rg       nome         exp      nasc    cpf      doc_origem                    
##   &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;                         
## 1 52.2X4.… MARIA EDUAR… 04/DEZ/… 01/DEZ… 314.291… &quot;C. NASC \&quot;LIV 84X - FLS 19X …</code></pre>
<p>Agora aproveitamos da pivot_wider(), função nova do tidyr para rotacionar nossa tabela e transformar ela em um formato ideal. O que anteriormente era a primeira coluna, agora está nos nomes. O que era a segunda coluna, agora está em uma só linha. Finalmente, tidy!</p>
<p>Contudo, o que eu mostrei anteriormente é que existe uma parte da frente da identidade da nossa querida Maria Eduarda. Vamos aproveitar para retirar a foto dela dali? Vai que você quer guardar uma 3x4 da Duda?</p>
<div class="figure">
<img src="../../img/id_frente.png" alt="frente" />
<p class="caption">frente</p>
</div>
<p>Para isso, usarei uma biblioteca experimental, que é a <code>image.libfacedetection</code> - que não está no CRAN, mas está aqui(LINK), junto à já bem conhecida biblioteca <code>magick</code>.</p>
<pre class="r"><code>img = magick::image_read(&#39;~/Imagens/id_frente.png&#39;) %&gt;% 
  image_rotate(270)

rosto = image_detect_faces(img)

plot(rosto, img, border = &quot;red&quot;, lwd = 3, col = &quot;white&quot;)</code></pre>
<p><img src="/post/2020-05-12-criando-texto-a-partir-de-uma-imagem-o-pacote-tesseract_files/figure-html/unnamed-chunk-6-1.png" /><!-- --></p>
<p>Primeiro, uso a <code>magick::image_read()</code> para fazer a leitura da imagem, carregando-a na memória. Logo rotaciono a imagem para que ela fique de pé, a rotação é importante pois a nossa <code>image.libfacedetection</code> não reconhecerá a face caso a imagem esteja deitada.</p>
<p>Passamos então a imagem já rotacionada à função <code>image_detect_faces()</code>, ela localizará onde estão as faces. Então uso a função <code>plot()</code> para marcar na nossa imagem onde está o rosto.</p>
<p>Feito isso, temos nosso rosto, temos nossos dados.</p>
<p>Abraços!</p>

    </div>
    <div class="read-more">
      <a href="/post/text-data-from-image-tesseract/" class="read-more-link">Read more...</a>
    </div>
  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/automated-carluxo-generator/">Markov-Chain Carluxo - Criando um bot para Twitter usando o algorítmo de Markov-Chain</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-05-01 </span>
      
    </div>
  </header>
  
  <div class="post-content">
    <div class="post-summary">
      no  O primeiro passo a ser feito é instalar e carregar três bibliotecas, a tidyverse, rtweet, markovchain, caso você não tenha-as instaladas instale-as direto do CRAN usando a função install.packages(). Não sabe como fazer? Digite help(install.packages) no console! Cada uma tem uma funcionalidade:
 Tidyverse: Uma metabiblioteca que contém um conjunto de ferramentas que adicionam uma nova sintaxe no R. Por meio delas é possível escrever um código mais limpo e eficiente.
    </div>
    <div class="read-more">
      <a href="/post/automated-carluxo-generator/" class="read-more-link">Read more...</a>
    </div>
  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/isis-nlp-analysis/">Escola ISIS de Radicalização Religiosa: Uma Análise com NLP</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-04-22 </span>
      <div class="post-category">
          <a href="/categories/nlp/"> nlp </a>
          <a href="/categories/lda/"> LDA </a>
          <a href="/categories/dificuldade-intermedi%C3%A1ria/"> dificuldade intermediária </a>
          </div>
    </div>
  </header>
  
  <div class="post-content">
    <div class="post-summary">
      Nesse post nós iremos fazer uma simples (e rápida) análise do dataset “ISIS Religious Texts v1”, que pode ser encontrado AQUI. Essa base de dados contém textos de duas revistas do ISIS, estas sendo a “Dabiq” e a “Rumyiah”, que são (ou eram?) usadas para propaganda política e recrutamento de novos membros para o grupo terrorista.
Primeiro começamos carregando as bibliotecas essenciais para a tarefa, com atenção à Rlang, que nos será bem util.
    </div>
    <div class="read-more">
      <a href="/post/isis-nlp-analysis/" class="read-more-link">Read more...</a>
    </div>
  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/entendendo-funcoes-cinco-minutos/">Entendendo funções em 5 minutos</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-03-18 </span>
      <div class="post-category">
          <a href="/categories/r/"> R </a>
          <a href="/categories/dificuldade-basica/"> dificuldade basica </a>
          </div>
    </div>
  </header>
  
  <div class="post-content">
    <div class="post-summary">
      Quando você estava no ensino médio (ou colegial/segundo grau, para os mais antigos) em algum momento aprendeu funções de primeiro grau e de segundo grau, sendo a mais memorável a fórmula de Bhaskara \((x= \frac{b^2\pm\sqrt{\Delta}}{2a})\). Porém, o que pode não ter percebido é que um aprendizado importante ficou, o de que funções ao receberem a entrada \(A_e\), sempre retornam \(B_s\). Ou seja, é sempre possível que uma função seja resolvida, não importando o dia e hora, caso uma série de conjuntos de instruções pré-determinadas sejam seguidos, e o resultado será sempre igual.
    </div>
    <div class="read-more">
      <a href="/post/entendendo-funcoes-cinco-minutos/" class="read-more-link">Read more...</a>
    </div>
  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/introducao-as-expressoes-regulares/">Introdução às Expressões Regulares em R</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-03-17 </span>
      <div class="post-category">
          <a href="/categories/nlp/"> nlp </a>
          <a href="/categories/dificuldade-intermediaria/"> dificuldade intermediaria </a>
          </div>
    </div>
  </header>
  
  <div class="post-content">
    <div class="post-summary">
      São utilizadas: Strings e Funções do R-Base e do {Stringr}; Conhecimento prévio necessário.  Parte 1. One Reason Why Trabalhar com texto em uma linguagem tão centrada em números quanto o R é um desafio para muitos. A quantidade de desafios a serem enfrentados já é grande desde o inicio, a começar pela falta de materiais disponíveis, e que quando estão disponíveis na maioria das vezes estes possuem somente versões em inglês.
    </div>
    <div class="read-more">
      <a href="/post/introducao-as-expressoes-regulares/" class="read-more-link">Read more...</a>
    </div>
  </div>
</article>

    </section>
  
  <nav class="pagination">
    
    
  </nav>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://stackoverflow.com/users/9829398/john-p-s" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="http://www.twitter.com/kimjoaoun" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.linkedin.com/in/joaoposantos/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="http://www.github.com/kimjoaoun" class="iconfont icon-github" title="github"></a>
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">João Pedro Oliveira dos Santos</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.cddea96674a99fd8cea50d36fb19d9c91f497feea4af5ce4596afd2dbaab9202.js"></script>








</body>
</html>
